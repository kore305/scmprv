{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>GDS Verified Schemes - Verified Government Initiatives</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link href="https://fonts.googleapis.com" rel="preconnect"/>
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
    <link href="https://fonts.googleapis.com/css2?family=Public+Sans:wght@400;500;700&display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>
    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#17cf17",
                        "background-light": "#f6f8f6",
                        "background-dark": "#112111",
                    },
                    fontFamily: {
                        "display": ["Public Sans"]
                    },
                    borderRadius: {
                        "DEFAULT": "0.25rem",
                        "lg": "0.5rem",
                        "xl": "0.75rem",
                        "full": "9999px"
                    },
                },
            },
        }
    </script>
    <style>
        .material-symbols-outlined {
            font-variation-settings:
            'FILL' 0,
            'wght' 400,
            'GRAD' 0,
            'opsz' 24
        }
    </style>
</head>
<body class="bg-background-light dark:bg-background-dark font-display text-neutral-800 dark:text-neutral-200">
    <div class="relative flex h-auto min-h-screen w-full flex-col">
        <!-- Header -->
        <header class="sticky top-0 z-10 w-full bg-background-light/80 dark:bg-background-dark/80 backdrop-blur-sm border-b border-neutral-200 dark:border-neutral-800">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex h-16 items-center justify-between">
                    <div class="flex items-center gap-4">
                        <svg class="h-8 w-8 text-primary" fill="none" viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg">
                            <path d="M42.4379 44C42.4379 44 36.0744 33.9038 41.1692 24C46.8624 12.9336 42.2078 4 42.2078 4L7.01134 4C7.01134 4 11.6577 12.932 5.96912 23.9969C0.876273 33.9029 7.27094 44 7.27094 44L42.4379 44Z" fill="currentColor"/>
                        </svg>
                        <h1 class="text-xl font-bold text-neutral-900 dark:text-white">GDS Verified Schemes</h1>
                    </div>
                    <nav class="hidden md:flex items-center gap-8">
                        <a class="text-sm font-medium hover:text-primary transition-colors" href="{% url 'landing' %}">Home</a>
                        <a class="text-sm font-medium text-primary" href="{% url 'initiatives' %}">Initiatives</a>
                        <a class="text-sm font-medium hover:text-primary transition-colors" href="{% url 'resources' %}">Resources</a>
                        <a class="text-sm font-medium hover:text-primary transition-colors" href="{% url 'verify_link' %}">Verify</a>
                        <a class="text-sm font-medium hover:text-primary transition-colors" href="{% url 'chatbot' %}">Chat</a>
                    </nav>
                    <div class="flex items-center gap-4">
                        <!-- Search Input -->
                        <div class="hidden sm:block">
                            <input type="text" id="searchInput" placeholder="Search programs..." 
                                   class="px-3 py-1.5 text-sm border border-neutral-300 dark:border-neutral-700 rounded-lg focus:ring-2 focus:ring-primary focus:outline-none bg-white dark:bg-neutral-900 text-neutral-900 dark:text-white">
                        </div>
                        <button class="p-2 rounded-full hover:bg-neutral-200/50 dark:hover:bg-neutral-800/50 transition-colors">
                            <span class="material-symbols-outlined">language</span>
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="flex-grow">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-12">
                <div class="max-w-4xl mx-auto">
                    <!-- Page Header -->
                    <div class="mb-12 text-center">
                        <h2 class="text-4xl font-bold tracking-tight text-neutral-900 dark:text-white sm:text-5xl">
                            Verified Government Initiatives
                        </h2>
                        <p class="mt-4 text-lg text-neutral-600 dark:text-neutral-400">
                            Explore a comprehensive list of government-backed programs designed to support citizens and communities.
                        </p>
                        <p class="mt-2 text-sm text-neutral-500 dark:text-neutral-500">
                            Showing {{ programs.count }} verified program{{ programs.count|pluralize }}
                        </p>
                    </div>

                    <!-- Mobile Search -->
                    <div class="mb-6 sm:hidden">
                        <input type="text" id="mobileSearchInput" placeholder="Search programs..." 
                               class="w-full px-4 py-2 border border-neutral-300 dark:border-neutral-700 rounded-lg focus:ring-2 focus:ring-primary focus:outline-none bg-white dark:bg-neutral-900 text-neutral-900 dark:text-white">
                    </div>

                    <!-- Filters -->
                    <div class="mb-8 flex flex-wrap gap-4">
                        <select id="sectorFilter" class="px-4 py-2 border border-neutral-300 dark:border-neutral-700 rounded-lg focus:ring-2 focus:ring-primary bg-white dark:bg-neutral-900 text-neutral-900 dark:text-white text-sm">
                            <option value="">All Sectors</option>
                            {% regroup programs by sector as sectors_list %}
                            {% for sector_group in sectors_list %}
                                <option value="{{ sector_group.grouper|lower }}">{{ sector_group.grouper }}</option>
                            {% endfor %}
                        </select>
                        
                        <select id="levelFilter" class="px-4 py-2 border border-neutral-300 dark:border-neutral-700 rounded-lg focus:ring-2 focus:ring-primary bg-white dark:bg-neutral-900 text-neutral-900 dark:text-white text-sm">
                            <option value="">All Levels</option>
                            <option value="federal">Federal</option>
                            <option value="state">State</option>
                            <option value="local">Local</option>
                        </select>

                        <select id="agencyFilter" class="px-4 py-2 border border-neutral-300 dark:border-neutral-700 rounded-lg focus:ring-2 focus:ring-primary bg-white dark:bg-neutral-900 text-neutral-900 dark:text-white text-sm">
                            <option value="">All Agencies</option>
                            {% regroup programs by agency as agencies_list %}
                            {% for agency_group in agencies_list %}
                                <option value="{{ agency_group.grouper|lower }}">{{ agency_group.grouper }}</option>
                            {% endfor %}
                        </select>
                    </div>

                    <!-- Programs List -->
                    <div class="space-y-6">
                        {% for program in programs %}
                        <div class="bg-white dark:bg-neutral-900/50 p-6 rounded-lg shadow-sm border border-neutral-200 dark:border-neutral-800 flex items-center justify-between gap-6 program-card"
                             data-sector="{{ program.sector|lower }}" 
                             data-level="{{ program.level|lower }}"
                             data-agency="{{ program.agency|lower }}"
                             data-name="{{ program.name|lower }}">
                            
                            <div class="flex-grow space-y-2">
                                <h3 class="text-lg font-bold text-neutral-900 dark:text-white">{{ program.name }}</h3>
                                <p class="text-sm text-neutral-600 dark:text-neutral-400">{{ program.sector }}</p>
                            </div>
                            
                            {% if program.link %}
                            <a href="{{ program.link }}" 
                               target="_blank" 
                               rel="noopener noreferrer"
                               class="flex-shrink-0 bg-primary text-white font-bold py-2 px-4 rounded-lg hover:opacity-90 transition-opacity">
                                Learn More
                            </a>
                            {% else %}
                            <button disabled class="flex-shrink-0 bg-neutral-300 dark:bg-neutral-700 text-neutral-500 dark:text-neutral-400 font-bold py-2 px-4 rounded-lg cursor-not-allowed">
                                Learn More
                            </button>
                            {% endif %}
                        </div>
                        {% empty %}
                        <!-- Empty State -->
                        <div class="text-center py-16">
                            <span class="material-symbols-outlined text-neutral-400 text-6xl mb-4 block">info</span>
                            <h3 class="text-lg font-semibold text-neutral-600 dark:text-neutral-400 mb-2">No Programs Found</h3>
                            <p class="text-neutral-500 dark:text-neutral-500 mb-4">
                                No government programs match your current filters.
                            </p>
                            <button onclick="clearFilters()" class="bg-primary text-white font-bold py-2 px-4 rounded-lg hover:opacity-90 transition-opacity">
                                Clear Filters
                            </button>
                        </div>
                        {% endfor %}
                    </div>

                    <!-- No Results Message (Hidden by default) -->
                    <div id="noResults" class="text-center py-16 hidden">
                        <span class="material-symbols-outlined text-neutral-400 text-6xl mb-4 block">search_off</span>
                        <h3 class="text-lg font-semibold text-neutral-600 dark:text-neutral-400 mb-2">No Programs Found</h3>
                        <p class="text-neutral-500 dark:text-neutral-500 mb-4">
                            No programs match your current search and filters.
                        </p>
                        <button onclick="clearFilters()" class="bg-primary text-white font-bold py-2 px-4 rounded-lg hover:opacity-90 transition-opacity">
                            Clear All Filters
                        </button>
                    </div>

                </div>
            </div>
        </main>
    </div>

    <script>
        // Search and filter functionality
        const searchInput = document.getElementById('searchInput');
        const mobileSearchInput = document.getElementById('mobileSearchInput');
        const sectorFilter = document.getElementById('sectorFilter');
        const levelFilter = document.getElementById('levelFilter');
        const agencyFilter = document.getElementById('agencyFilter');
        const programCards = document.querySelectorAll('.program-card');
        const noResults = document.getElementById('noResults');

        function filterPrograms() {
            const searchTerm = (searchInput?.value || mobileSearchInput?.value || '').toLowerCase();
            const selectedSector = sectorFilter.value.toLowerCase();
            const selectedLevel = levelFilter.value.toLowerCase();
            const selectedAgency = agencyFilter.value.toLowerCase();

            let visibleCount = 0;

            programCards.forEach(card => {
                const name = card.dataset.name;
                const sector = card.dataset.sector;
                const level = card.dataset.level;
                const agency = card.dataset.agency;

                const matchesSearch = name.includes(searchTerm) || 
                                    sector.includes(searchTerm) || 
                                    agency.includes(searchTerm);
                const matchesSector = !selectedSector || sector === selectedSector;
                const matchesLevel = !selectedLevel || level === selectedLevel;
                const matchesAgency = !selectedAgency || agency === selectedAgency;

                if (matchesSearch && matchesSector && matchesLevel && matchesAgency) {
                    card.style.display = 'flex';
                    visibleCount++;
                } else {
                    card.style.display = 'none';
                }
            });

            // Show/hide no results message
            if (noResults) {
                noResults.style.display = visibleCount === 0 ? 'block' : 'none';
            }
        }

        function clearFilters() {
            if (searchInput) searchInput.value = '';
            if (mobileSearchInput) mobileSearchInput.value = '';
            sectorFilter.value = '';
            levelFilter.value = '';
            agencyFilter.value = '';
            filterPrograms();
        }

        // Sync search inputs
        function syncSearchInputs(sourceInput, targetInput) {
            if (sourceInput && targetInput) {
                targetInput.value = sourceInput.value;
            }
        }

        // Event listeners
        if (searchInput) {
            searchInput.addEventListener('input', (e) => {
                syncSearchInputs(searchInput, mobileSearchInput);
                filterPrograms();
            });
        }
        
        if (mobileSearchInput) {
            mobileSearchInput.addEventListener('input', (e) => {
                syncSearchInputs(mobileSearchInput, searchInput);
                filterPrograms();
            });
        }

        sectorFilter.addEventListener('change', filterPrograms);
        levelFilter.addEventListener('change', filterPrograms);
        agencyFilter.addEventListener('change', filterPrograms);

        // Dark mode support
        if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
    </script>
</body>
</html>